I"´-<ul id="markdown-toc">
  <li><a href="#æè¿°èƒŒæ™¯" id="markdown-toc-æè¿°èƒŒæ™¯">æè¿°èƒŒæ™¯ï¼š</a></li>
  <li><a href="#åˆ›å»º-pod-å¤±è´¥describe-pod-çœ‹-event-æŠ¥-no-space-left-on-deviceé›†ç¾¤è¿è¡Œ120å¤©å·¦å³å‡ºç°" id="markdown-toc-åˆ›å»º-pod-å¤±è´¥describe-pod-çœ‹-event-æŠ¥-no-space-left-on-deviceé›†ç¾¤è¿è¡Œ120å¤©å·¦å³å‡ºç°">åˆ›å»º Pod å¤±è´¥ï¼Œdescribe pod çœ‹ event æŠ¥ no space left on device.é›†ç¾¤è¿è¡Œ120å¤©å·¦å³å‡ºç°ã€‚</a></li>
  <li><a href="#pruneå‘½ä»¤çš„ä½¿ç”¨" id="markdown-toc-pruneå‘½ä»¤çš„ä½¿ç”¨">pruneå‘½ä»¤çš„ä½¿ç”¨ï¼š</a>    <ul>
      <li><a href="#1-prune-images" id="markdown-toc-1-prune-images">1. Prune Images</a></li>
      <li><a href="#2-prune-containers" id="markdown-toc-2-prune-containers">2. Prune containers</a></li>
      <li><a href="#3-prune-volumes" id="markdown-toc-3-prune-volumes">3. prune volumes</a></li>
      <li><a href="#4-prune-networks" id="markdown-toc-4-prune-networks">4. prune networks</a></li>
      <li><a href="#5-prune-everything" id="markdown-toc-5-prune-everything">5. prune everything</a></li>
    </ul>
  </li>
</ul>

<h1 id="æè¿°èƒŒæ™¯">æè¿°èƒŒæ™¯ï¼š</h1>
<p>æ³¨ï¼šè®°å½•å„ç§å¸¸è§é—®é¢˜</p>

<p>é›†ç¾¤é…ç½®ï¼š
åˆå§‹é›†ç¾¤ç¯å¢ƒkubeadm 1.16.1</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ip</th>
      <th style="text-align: center">è‡ªå®šä¹‰åŸŸå</th>
      <th style="text-align: center">ä¸»æœºå</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">192.168.3.8</td>
      <td style="text-align: center">master.k8s.io</td>
      <td style="text-align: center">k8s-vip</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.3.10</td>
      <td style="text-align: center">master01.k8s.io</td>
      <td style="text-align: center">k8s-master-01</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.3.5</td>
      <td style="text-align: center">master02.k8s.io</td>
      <td style="text-align: center">k8s-master-02</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.3.12</td>
      <td style="text-align: center">master03.k8s.io</td>
      <td style="text-align: center">k8s-master-03</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.3.6</td>
      <td style="text-align: center">node01.k8s.io</td>
      <td style="text-align: center">k8s-node-01</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.3.2</td>
      <td style="text-align: center">node02.k8s.io</td>
      <td style="text-align: center">k8s-node-02</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.3.4</td>
      <td style="text-align: center">node03.k8s.io</td>
      <td style="text-align: center">k8s-node-03</td>
    </tr>
  </tbody>
</table>

<h1 id="åˆ›å»º-pod-å¤±è´¥describe-pod-çœ‹-event-æŠ¥-no-space-left-on-deviceé›†ç¾¤è¿è¡Œ120å¤©å·¦å³å‡ºç°">åˆ›å»º Pod å¤±è´¥ï¼Œdescribe pod çœ‹ event æŠ¥ no space left on device.é›†ç¾¤è¿è¡Œ120å¤©å·¦å³å‡ºç°ã€‚</h1>
<blockquote>
  <p>å¯å‚ç…§https://www.bookstack.cn/read/kubernetes-practice-guide/troubleshooting-problems-errors-no-space-left-on-device.mdã€‚å‡ºç°æ­¤é—®é¢˜cgroupæ³„éœ²é—®é¢˜ã€‚æœ€ç¬¨æ–¹æ³•å¯ä»¥ç”¨rebootä¸‹ï¼Œæˆ–è€…åˆ é™¤èŠ‚ç‚¹é‡æ–°æ·»åŠ ä¸‹ã€‚ç„äº†ä¸€çœ¼/var/lib/docker/overlay2 ä¸‹æ–‡ä»¶æœ‰å¿«70Gï¼Œ/var/log/journal/æ—¥å¿—ä¹Ÿæœ‰4-5Gã€‚</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>journalctl <span class="nt">--vacuum-size</span><span class="o">=</span>20M
è®¾ç½®journal æ—¥å¿—æœ€å¤§ä¸º20Mä¸ä¿ç•™ä¸å¿…è¦æ—¥å¿—ã€‚
</code></pre></div></div>
<h1 id="pruneå‘½ä»¤çš„ä½¿ç”¨">pruneå‘½ä»¤çš„ä½¿ç”¨ï¼š</h1>
<blockquote>
  <p>çœ‹äº†ä¸‹æ–‡æ¡£ä¸èµ„æ–™ï¼Œå¯¹äºä¸å†ä½¿ç”¨çš„é•œåƒå®¹å™¨ï¼Œå­˜å‚¨ä»¥åŠç½‘ç»œèµ„æº dockeré‡‡å–çš„æ˜¯è¢«åŠ¨æ¸…ç†æ–¹å¼ã€‚æ‰€ä»¥è‡ªç„¶è€Œç„¶çš„ï¼Œé»˜è®¤æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ã€‚docker ä¹Ÿä¸ºæ­¤æä¾›äº†pruneçš„å‘½ä»¤ã€‚</p>
</blockquote>

<h2 id="1-prune-images">1. Prune Images</h2>
<blockquote>
  <p>docker image prune å¯ä»¥ç”¨æ¥æ¸…ç†ä¸å†ä½¿ç”¨çš„dockeré•œåƒã€‚æ‰§è¡Œdocker image pruneé»˜è®¤ä¼šæ¸…é™¤â€æ‚¬ç©ºâ€é•œåƒã€‚â€œæ‚¬ç©ºâ€é•œåƒï¼Œå°±æ˜¯æ—¢æ²¡æœ‰æ ‡ç­¾åä¹Ÿæ²¡æœ‰å®¹å™¨å¼•ç”¨çš„é•œåƒå°±å«â€æ‚¬ç©ºâ€é•œåƒã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker image prune
WARNING! This will remove all dangling images.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
æƒ³è¦æ¸…é™¤æ‰€æœ‰æ²¡æœ‰å®¹å™¨å¼•ç”¨çš„é•œåƒï¼Œå¢åŠ ä¸€ä¸ª <span class="nt">-a</span> æ ‡å¿—å°±å¯ä»¥æå®šï¼š
<span class="nv">$ </span>docker image prune <span class="nt">-a</span>
WARNING! This will remove all images without at least one container associated to them.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
æ¸…é™¤æ“ä½œä¼šæé†’ä½ æ˜¯å¦çœŸå¿ƒæƒ³è¦æ¸…é™¤å¯¹è±¡ï¼Œé»˜è®¤æ˜¯é€‰é¡¹ä¼šæ˜¯yesï¼›ä½†æ˜¯å¦‚æœä½ å«Œæç¤ºéº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡-f æˆ–è€…--forceæ ‡å¿—æ¥è¿›è¡Œå¼ºåˆ¶æ¸…é™¤ã€‚
æ›´åŠ äººæ€§åŒ–çš„æ˜¯ï¼ŒDockeræä¾›äº†--filteræ ‡å¿—ç­›é€‰å‡ºæƒ³è¦ä¿ç•™çš„é•œåƒã€‚ä¾‹å¦‚ï¼šåªæ¸…é™¤è¶…è¿‡åˆ›å»ºæ—¶é—´è¶…è¿‡24å°æ—¶çš„é•œåƒå¯ä»¥è¿™æ ·æ¥æ“ä½œï¼š
<span class="nv">$ </span>docker image prune <span class="nt">-a</span> <span class="nt">--filter</span> <span class="s2">"until=24h"</span>
 å½“ç„¶è¿˜èƒ½å¤Ÿé€šè¿‡å…¶ä»–çš„è¡¨è¾¾å¼æ¥å®šåˆ¶æˆ‘çš„é•œåƒæ¸…ç†è®¡åˆ’ã€‚æ›´å¤šçš„ç¤ºä¾‹å‚è€ƒdocker image prune.
</code></pre></div></div>
<h2 id="2-prune-containers">2. Prune containers</h2>
<blockquote>
  <p>å®¹å™¨å¯åŠ¨æ—¶æ²¡æœ‰æŒ‡å®šâ€“rmé€‰é¡¹ï¼Œå®¹å™¨åœæ­¢æ—¶æ˜¯ä¸èƒ½å¤Ÿè‡ªåŠ¨æ¸…é™¤çš„ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æ— æ‰€äº‹äº‹çš„æ•²ä¸‹docker ps -aå‘½ä»¤ä¼šæƒŠå¥‡çš„å‘ç°ï¼Œå¤©å“ªï¼Œå±…ç„¶æœ‰è¿™ä¹ˆå¤šå®¹å™¨ï¼Œæœ‰è¿è¡Œç€çš„ä¹Ÿæœ‰åœæ­¢äº†çš„ã€‚å®ƒä»¬æ˜¯å“ªé‡Œæ¥çš„ï¼Ÿå®ƒä»¬åˆ°åº•è¿˜æœ‰æ²¡æœ‰äººåœ¨å…³æ³¨ï¼Ÿè¿™ç§æƒ…å†µåœ¨ä¸€ä¸ªå¼€å‘ç¯å¢ƒä¸Šå°¤å…¶å¸¸è§ã€‚å³ä½¿å®¹å™¨å·²ç»åœæ‰äº†ä¹Ÿä¼šå ç”¨ç©ºé—´èµ„æºã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨docker container pruneå‘½ä»¤:</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container prune
WARNING! This will remove all stopped containers.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] 
å’Œé•œåƒæ¸…ç†çš„æƒ…å†µä¸€æ ·ï¼Œä¹Ÿä¼šæœ‰æç¤ºä¿¡æ¯å‘Šè¯‰ä½ æ˜¯å¦ç»§ç»­ï¼Œé»˜è®¤æ˜¯yesï¼›å¦‚æœæç¤ºä¿¡æ¯çƒ¦åˆ°äº†ä½ çš„è¯å°±åŠ ä¸Š <span class="nt">-f</span> æˆ–è€… <span class="nt">--force</span>æ ‡å¿—å¼ºåˆ¶æ¸…é™¤å°±å¯ä»¥äº†ã€‚
é»˜è®¤æƒ…å†µä¸‹docker container pruneå‘½ä»¤ä¼šæ¸…ç†æ‰æ‰€æœ‰å¤„äºstoppedçŠ¶æ€çš„å®¹å™¨ï¼›å¦‚æœä¸æƒ³é‚£ä¹ˆæ®‹å¿ç»Ÿç»Ÿéƒ½åˆ æ‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨--filteræ ‡å¿—æ¥ç­›é€‰å‡ºä¸å¸Œæœ›è¢«æ¸…ç†æ‰çš„å®¹å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç­›é€‰çš„ä¾‹å­ï¼Œæ¸…é™¤æ‰æ‰€æœ‰åœæ‰çš„å®¹å™¨ï¼Œä½†24å†…åˆ›å»ºçš„é™¤å¤–ï¼š
<span class="nv">$ </span>docker container prune <span class="nt">--filter</span> <span class="s2">"until=24h"</span>
å…¶ä»–çš„ç­›é€‰æ¡ä»¶çš„å®ç°å¯ä»¥å‚è€ƒï¼šdocker container prune referenceï¼Œ è¿™é‡Œæœ‰æ›´å¤šçš„è¯¦ç»†çš„ä¾‹å­ã€‚
</code></pre></div></div>

<h2 id="3-prune-volumes">3. prune volumes</h2>

<blockquote>
  <p>Volumeså¯è¢«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨ä¼šæ¶ˆè€—hostç«¯çš„ç©ºé—´ï¼Œä½†å®ƒä¸ä¼šè‡ªåŠ¨æ¸…ç†ï¼Œå› ä¸ºé‚£æ ·å°±æœ‰å¯èƒ½ç ´åæ‰æœ‰ç”¨çš„æ•°æ®ã€‚</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker volume prune
WARNING! This will remove all volumes not used by at least one container.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
å’Œconatinerä¸€æ ·ï¼Œæ‰‹åŠ¨æ¸…ç†Volumeæ—¶ä¼šæœ‰æç¤ºä¿¡æ¯ï¼Œå¢åŠ -f æˆ–--forceæ ‡å¿—å¯ä»¥è·³è¿‡æç¤ºä¿¡æ¯ç›´æ¥æ¸…ç†ã€‚ä½¿ç”¨è¿‡æ»¤å‚æ•°--filteræ¥ç­›é€‰å‡ºä¸å¸Œæœ›æ¸…ç†çš„æ— ç”¨Volumeï¼Œå¦åˆ™é»˜è®¤ä¼šå°†æ‰€æœ‰æ²¡æœ‰ä½¿ç”¨çš„volumeséƒ½æ¸…ç†æ‰ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†é™¤lable<span class="o">=</span>keepå¤–çš„volumeå¤–éƒ½æ¸…ç†æ‰<span class="o">(</span>æ²¡æœ‰å¼•ç”¨çš„volume<span class="o">)</span>ï¼š
<span class="nv">$ </span>docker volume prune <span class="nt">--filter</span> <span class="s2">"label!=keep"</span>
å…¶ä»–çš„ç­›é€‰æ¡ä»¶çš„å®ç°å¯ä»¥å‚è€ƒï¼šdocker volume prune referenceï¼Œè¿™é‡Œç»™å‡ºäº†æ›´å¤šå‚è€ƒç¤ºä¾‹ã€‚
</code></pre></div></div>

<h2 id="4-prune-networks">4. prune networks</h2>

<blockquote>
  <p>è™½ç„¶Docker networkså ç”¨çš„ç©ºé—´ä¸å¤šï¼Œä½†æ˜¯å®ƒä¼šåˆ›å»ºiptable è§„åˆ™ã€è™šæ‹Ÿç½‘æ¡¥è®¾å¤‡ä»¥åŠè·¯ç”±è¡¨é¡¹ï¼Œæœ‰æ´ç™–çš„ä½ çœ‹åˆ°è¿™ä¹ˆå¤šâ€åƒµå°¸â€å¯¹è±¡ä¼šä¸ä¼šæŠ“ç‹‚ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ç”¨æ¸…ç†ç¥å™¨ï¼šdocker network prune æ¥æ¸…ç†æ²¡æœ‰å†è¢«ä»»ä½•å®¹å™¨å¼•ç”¨çš„networksï¼š</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network prune
 
WARNING! This will remove all networks not used by at least one container.
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
 å¯ä»¥é€šè¿‡ <span class="nt">-f</span> æˆ–è€… <span class="nt">--force</span>æ ‡å¿—è·³è¿‡æç¤ºä¿¡æ¯æ¥å¼ºåˆ¶æ‰§è¡Œè¯¥å‘½ä»¤ã€‚é»˜è®¤æƒ…å†µä¼šæ¸…é™¤æ‰€æœ‰æ²¡æœ‰å†è¢«å¼•ç”¨çš„networksï¼Œå¦‚æœæƒ³è¦è¿‡æ»¤ä¸€äº›ç‰¹å®šçš„networksï¼Œå¯ä»¥ä½¿ç”¨--filteræ¥å®ç°ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ˜¯é€šè¿‡--filteræ¥æ¸…ç†æ²¡æœ‰è¢«å¼•ç”¨çš„ã€åˆ›å»ºè¶…è¿‡24å°æ—¶çš„networksï¼š
<span class="nv">$ </span>docker network prune <span class="nt">--filter</span> <span class="s2">"until=24h"</span>
æ›´å¤šå…³äºdocker networkçš„--filterçš„ç­›é€‰æ¡ä»¶å¯å‚è€ƒç¤ºä¾‹ï¼šdocker network prune reference ã€‚
</code></pre></div></div>

<h2 id="5-prune-everything">5. prune everything</h2>
<blockquote>
  <p>å¦‚é¢˜ï¼Œè¿™é‡Œè¦è®²çš„å°±æ˜¯æ¸…ç†everythingï¼šimages ï¼Œcontainersï¼Œnetworksä¸€æ¬¡æ€§æ¸…ç†æ“ä½œå¯ä»¥é€šè¿‡docker system pruneæ¥æå®šã€‚åœ¨Docker 17.06.0 ä»¥åŠæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªdocker system pruneä¹Ÿä¼šå°†volumeä¸€èµ·æ¸…ç†æ‰ï¼›åœ¨Docker 17.06.1ä»¥åŠåæœŸçš„ç‰ˆæœ¬ä¸­åˆ™å¿…é¡»è¦æ‰‹åŠ¨æŒ‡å®šâ€“volumesæ ‡å¿—æ‰èƒ½å¤Ÿæ¸…ç†æ‰volumesï¼š</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker system prune
 
WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all dangling images
        - all build cache
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
åœ¨Docker 17.06.1æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­æ·»åŠ --volumesæ ‡å¿—çš„æƒ…å†µï¼š
<span class="nv">$ </span>docker system prune <span class="nt">--volumes</span>
 
WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all volumes not used by at least one container
        - all dangling images
        - all build cache
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
è²Œä¼¼åˆ é™¤å¾ˆæœ‰é™ï¼Œæˆ‘çš„åªåˆ é™¤äº†å‡ ç™¾m
docker system prune <span class="nt">-a</span> 
WARNING! This will remove:
        - all stopped containers
        - all networks not used by at least one container
        - all volumes not used by at least one container
        - all dangling images
        - all build cache
Are you sure you want to <span class="k">continue</span>? <span class="o">[</span>y/N] y
è¿™æ ·ç®¡ç”¨äº›åˆ é™¤äº† 12Gç©ºé—´
</code></pre></div></div>
<p><img src="/assets/images/qustion/prune.png" alt="prune.png" />
<img src="/assets/images/qustion/prune1.png" alt="prune1.png" />
<img src="/assets/images/qustion/prune2.png" alt="prune2.png" /></p>

:ET