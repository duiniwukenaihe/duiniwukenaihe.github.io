I"«<ul id="markdown-toc">
  <li><a href="#æè¿°èƒŒæ™¯" id="markdown-toc-æè¿°èƒŒæ™¯">æè¿°èƒŒæ™¯ï¼š</a></li>
</ul>

<h2 id="æè¿°èƒŒæ™¯">æè¿°èƒŒæ™¯ï¼š</h2>
<p>å·²ç»æ­å»ºå®Œçš„k8sé›†ç¾¤åªæœ‰ä¸¤ä¸ªworkerèŠ‚ç‚¹ï¼Œç°åœ¨å¢åŠ workèŠ‚ç‚¹åˆ°é›†ç¾¤ã€‚åŸæœ‰é›†ç¾¤æœºå™¨ï¼š</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ip</th>
      <th style="text-align: center">è‡ªå®šä¹‰åŸŸå</th>
      <th style="text-align: center">ä¸»æœºå</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Â </td>
      <td style="text-align: center">master.k8s.io</td>
      <td style="text-align: center">k8s-vip</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.0.195</td>
      <td style="text-align: center">master01.k8s.io</td>
      <td style="text-align: center">k8s-master-01</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.0.197</td>
      <td style="text-align: center">master02.k8s.io</td>
      <td style="text-align: center">k8s-master-02</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.0.198</td>
      <td style="text-align: center">master03.k8s.io</td>
      <td style="text-align: center">k8s-master-03</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.0.199</td>
      <td style="text-align: center">node01.k8s.io</td>
      <td style="text-align: center">k8s-node-01</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.0.202</td>
      <td style="text-align: center">node02.k8s.io</td>
      <td style="text-align: center">k8s-node-02</td>
    </tr>
  </tbody>
</table>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>æœ¬åœ°æ­å»ºçš„ç”¨äº†ä¸€ç§ä¸è¦è„¸çš„æ–¹å¼ï¼ŒåŸºæœ¬æ­å»ºæ–¹å¼å¦‚https://duiniwukenaihe.github.io/2019/09/02/k8s-install/ï¼Œ master01  master02  èŠ‚ç‚¹host  master.k8s.ioç»‘å®šäº†192.168.0.195.master03èŠ‚ç‚¹master.k8s.ioç»‘å®šäº†192.168.0.197è·‘äº†ä¸‹è²Œä¼¼ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ç°åœ¨å°†ä¸€ä¸‹ä¸‰å°æœºå™¨åŠ å…¥é›†ç¾¤ï¼š

|192.168.0.108    |  node03.k8s.io    |  k8s-node-03|
|192.168.0.111    |  node04.k8s.io    |  k8s-node-04|
|192.168.0.115    |  node05.k8s.io    |  k8s-node-05|


ä¸‰å°ç»‘å®šhost
192.168.0.108
<span class="nb">cat</span> /etc/host
192.168.0.197  master.k8s.io      k8s-vip
192.168.0.195  master01.k8s.io  k8s-master-01
192.168.0.197  master02.k8s.io  k8s-master-02
192.168.0.198  master03.k8s.io  k8s-master-03

192.168.111
<span class="nb">cat</span> /etc/host
192.168.0.198  master.k8s.io      k8s-vip
192.168.0.195  master01.k8s.io  k8s-master-01
192.168.0.197  master02.k8s.io  k8s-master-02
192.168.0.198  master03.k8s.io  k8s-master-03

192.168.115
<span class="nb">cat</span> /etc/host
192.168.0.195  master.k8s.io      k8s-vip
192.168.0.195  master01.k8s.io  k8s-master-01
192.168.0.197  master02.k8s.io  k8s-master-02
192.168.0.198  master03.k8s.io  k8s-master-03


å‚ç…§https://duiniwukenaihe.github.io/2019/09/02/k8s-install/å®Œæˆç³»ç»Ÿå‚æ•°è°ƒä¼˜ï¼Œé…ç½®yumæº  å®‰è£…docker kubernetes 
</code></pre></div></div>

<p>ä»»ä¸€masterèŠ‚ç‚¹æ‰§è¡Œkubeadm token listï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æœ‰æ•ˆæœŸå†…tokenå’ŒSH256åŠ å¯†å­—ç¬¦ä¸²</p>

<p><img src="/assets/images/k8s/token.list.png" alt="token.list.png" /> 
tokené»˜è®¤çš„æœ‰æ•ˆæœŸæ˜¯24å°æ—¶ï¼Œå¦‚æœæ²¡æœ‰æœ‰æ•ˆtokenï¼Œåˆ™å°†åˆ›å»ºtoken</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm token create

openssl x509 <span class="nt">-pubkey</span> <span class="nt">-in</span> /etc/kubernetes/pki/ca.crt | openssl rsa <span class="nt">-pubin</span> <span class="nt">-outform</span> der 2&gt;/dev/null | openssl dgst <span class="nt">-sha256</span> <span class="nt">-hex</span> | <span class="nb">sed</span> <span class="s1">'s/^.* //'</span>
</code></pre></div></div>
<p><img src="/assets/images/k8s/token.list1.png" alt="token.list1.png" /></p>

<p>k8s-node-03 k8s-node-04 k8s-node-05èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</p>

<p><img src="/assets/images/k8s/token.list2.png" alt="token.list2.png" /></p>

<p>æ²¡æœ‰å…³é—­swap  åŠ å…¥é›†ç¾¤å‘½ä»¤åŠ å…¥â€“ignore-preflight-errors=Swapï¼š</p>

<p>kubeadm join master.k8s.io:8443 â€“token u7lv9t.bubw4r69tkmorug2     â€“discovery-token-ca-cert-hash sha256:74e007d58a810fd4e8a233158d0b8e195641f724ad402e4afddc77e0eb003d95   â€“ignore-preflight-errors=Swap
<img src="/assets/images/k8s/token.list3.png" alt="token.list3.png" />
masterèŠ‚ç‚¹æ‰§è¡Œkubectl get nodes
<img src="/assets/images/k8s/token.list4.png" alt="token.list4.png" /></p>
:ET